---
import type { GetStaticPaths, InferGetStaticPropsType } from 'astro';

import { type CollectionEntry } from 'astro:content';

import PostList from '~/components/PostList.astro';
import Prose from '~/components/Prose.astro';
import BaseLayout from '~/layouts/BaseLayout.astro';
import { getPosts } from '~/lib/posts';

type Props = InferGetStaticPropsType<typeof getStaticPaths>;

export const getStaticPaths = (async () => {
	const posts = await getPosts();

	const categoryPosts: Record<string, CollectionEntry<'blog'>[]> = {};
	for (const post of posts) {
		for (const category of post.data.categories) {
			categoryPosts[category] = (categoryPosts[category] ?? []).concat(
				post,
			);
		}
	}
	return Object.entries(categoryPosts).map(([category, posts]) => ({
		params: { slug: category },
		props: { category, posts },
	}));
}) satisfies GetStaticPaths;

const { category, posts } = Astro.props;
---

<BaseLayout>
	<h1 class="font-thin text-6xl text-center mb-10">
		Posts filed as:
		<strong class="font-normal capitalize">
			{category}
		</strong>
	</h1>
	<PostList posts={posts} />
</BaseLayout>
